(()=>{var Hs=Object.defineProperty;var Yr=(m,s)=>()=>(s||m((s={exports:{}}).exports,s),s.exports),Ws=(m,s)=>{for(var i in s)Hs(m,i,{get:s[i],enumerable:!0})};var nr=Yr(()=>{});var Gr=Yr(()=>{});var Ls=(()=>{var m=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(m=m||__filename),function(s){s=s||{};var i=typeof s<"u"?s:{},y,$;i.ready=new Promise(function(e,t){y=e,$=t});var j=Object.assign({},i),x=[],G="./this.program",J=(e,t)=>{throw t},he=typeof window=="object",k=typeof importScripts=="function",Je=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",K="";function Xe(e){return i.locateFile?i.locateFile(e,K):K+e}var Me,Ue,Re,Te;function W(e){if(e instanceof Hr)return;Ae("exiting due to exception: "+e)}var He,Ce,Ze;Je?(k?K=nr().dirname(K)+"/":K=__dirname+"/",Ze=()=>{Ce||(He=Gr(),Ce=nr())},Me=function(t,r){return Ze(),t=Ce.normalize(t),He.readFileSync(t,r?void 0:"utf8")},Re=e=>{var t=Me(e,!0);return t.buffer||(t=new Uint8Array(t)),t},Ue=(e,t,r)=>{Ze(),e=Ce.normalize(e),He.readFile(e,function(n,l){n?r(n):t(l.buffer)})},process.argv.length>1&&(G=process.argv[1].replace(/\\/g,"/")),x=process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof Hr))throw e}),process.on("unhandledRejection",function(e){throw e}),J=(e,t)=>{if(tn())throw process.exitCode=e,t;W(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}):(he||k)&&(k?K=self.location.href:typeof document<"u"&&document.currentScript&&(K=document.currentScript.src),m&&(K=m),K.indexOf("blob:")!==0?K=K.substr(0,K.replace(/[?#].*/,"").lastIndexOf("/")+1):K="",Me=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},k&&(Re=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),Ue=(e,t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){t(n.response);return}r()},n.onerror=r,n.send(null)},Te=e=>document.title=e);var Ee=i.print||console.log.bind(console),Ae=i.printErr||console.warn.bind(console);Object.assign(i,j),j=null,i.arguments&&(x=i.arguments),i.thisProgram&&(G=i.thisProgram),i.quit&&(J=i.quit);var o=4,a=0,f=e=>{a=e},h;i.wasmBinary&&(h=i.wasmBinary);var g=i.noExitRuntime||!0;typeof WebAssembly!="object"&&Le("no native wasm support detected");var A,P=!1,b;function I(e,t){e||Le(t)}var S=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function z(e,t,r){t>>>=0;for(var n=t+r,l=t;e[l]&&!(l>=n);)++l;if(l-t>16&&e.buffer&&S)return S.decode(e.subarray(t,l));for(var c="";t<l;){var _=e[t++];if(!(_&128)){c+=String.fromCharCode(_);continue}var u=e[t++]&63;if((_&224)==192){c+=String.fromCharCode((_&31)<<6|u);continue}var d=e[t++]&63;if((_&240)==224?_=(_&15)<<12|u<<6|d:_=(_&7)<<18|u<<12|d<<6|e[t++]&63,_<65536)c+=String.fromCharCode(_);else{var v=_-65536;c+=String.fromCharCode(55296|v>>10,56320|v&1023)}}return c}function M(e,t){return e>>>=0,e?z(U,e,t):""}function q(e,t,r,n){if(r>>>=0,!(n>0))return 0;for(var l=r,c=r+n-1,_=0;_<e.length;++_){var u=e.charCodeAt(_);if(u>=55296&&u<=57343){var d=e.charCodeAt(++_);u=65536+((u&1023)<<10)|d&1023}if(u<=127){if(r>=c)break;t[r++>>>0]=u}else if(u<=2047){if(r+1>=c)break;t[r++>>>0]=192|u>>6,t[r++>>>0]=128|u&63}else if(u<=65535){if(r+2>=c)break;t[r++>>>0]=224|u>>12,t[r++>>>0]=128|u>>6&63,t[r++>>>0]=128|u&63}else{if(r+3>=c)break;t[r++>>>0]=240|u>>18,t[r++>>>0]=128|u>>12&63,t[r++>>>0]=128|u>>6&63,t[r++>>>0]=128|u&63}}return t[r>>>0]=0,r-l}function fe(e,t,r){return q(e,U,t,r)}function se(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((n&1023)<<10)|e.charCodeAt(++r)&1023),n<=127?++t:n<=2047?t+=2:n<=65535?t+=3:t+=4}return t}var _e=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function We(e,t){for(var r=e,n=r>>1,l=n+t/2;!(n>=l)&&xe[n>>>0];)++n;if(r=n<<1,r-e>32&&_e)return _e.decode(U.subarray(e>>>0,r>>>0));for(var c="",_=0;!(_>=t/2);++_){var u=ve[e+_*2>>>1];if(u==0)break;c+=String.fromCharCode(u)}return c}function ht(e,t,r){if(r===void 0&&(r=2147483647),r<2)return 0;r-=2;for(var n=t,l=r<e.length*2?r/2:e.length,c=0;c<l;++c){var _=e.charCodeAt(c);ve[t>>>1]=_,t+=2}return ve[t>>>1]=0,t-n}function $t(e){return e.length*2}function oe(e,t){for(var r=0,n="";!(r>=t/4);){var l=O[e+r*4>>>2];if(l==0)break;if(++r,l>=65536){var c=l-65536;n+=String.fromCharCode(55296|c>>10,56320|c&1023)}else n+=String.fromCharCode(l)}return n}function ne(e,t,r){if(t>>>=0,r===void 0&&(r=2147483647),r<4)return 0;for(var n=t,l=n+r-4,c=0;c<e.length;++c){var _=e.charCodeAt(c);if(_>=55296&&_<=57343){var u=e.charCodeAt(++c);_=65536+((_&1023)<<10)|u&1023}if(O[t>>>2]=_,t+=4,t+4>l)break}return O[t>>>2]=0,t-n}function me(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function le(e){var t=se(e)+1,r=ft(t);return r&&q(e,Z,r,t),r}function te(e,t){Z.set(e,t>>>0)}function ue(e,t,r){for(var n=0;n<e.length;++n)Z[t++>>>0]=e.charCodeAt(n);r||(Z[t>>>0]=0)}var ae,Z,U,ve,xe,O,H,_r,Nt;function dr(e){ae=e,i.HEAP8=Z=new Int8Array(e),i.HEAP16=ve=new Int16Array(e),i.HEAP32=O=new Int32Array(e),i.HEAPU8=U=new Uint8Array(e),i.HEAPU16=xe=new Uint16Array(e),i.HEAPU32=H=new Uint32Array(e),i.HEAPF32=_r=new Float32Array(e),i.HEAPF64=Nt=new Float64Array(e)}var no=i.INITIAL_MEMORY||16777216,pr,hr=[],mr=[],vr=[],en=!1;function tn(){return g}function rn(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)on(i.preRun.shift());It(hr)}function nn(){en=!0,It(mr)}function sn(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)ln(i.postRun.shift());It(vr)}function on(e){hr.unshift(e)}function an(e){mr.unshift(e)}function ln(e){vr.unshift(e)}var Ne=0,Dt=null,Ke=null;function un(e){Ne++,i.monitorRunDependencies&&i.monitorRunDependencies(Ne)}function cn(e){if(Ne--,i.monitorRunDependencies&&i.monitorRunDependencies(Ne),Ne==0&&(Dt!==null&&(clearInterval(Dt),Dt=null),Ke)){var t=Ke;Ke=null,t()}}function Le(e){i.onAbort&&i.onAbort(e),e="Aborted("+e+")",Ae(e),P=!0,b=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw $(t),t}var fn="data:application/octet-stream;base64,";function gr(e){return e.startsWith(fn)}function yr(e){return e.startsWith("file://")}var ie;ie="perspective.cpp.wasm",gr(ie)||(ie=Xe(ie));function wr(e){try{if(e==ie&&h)return new Uint8Array(h);if(Re)return Re(e);throw"both async and sync fetching of the wasm failed"}catch(t){Le(t)}}function _n(){if(!h&&(he||k)){if(typeof fetch=="function"&&!yr(ie))return fetch(ie,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ie+"'";return e.arrayBuffer()}).catch(function(){return wr(ie)});if(Ue)return new Promise(function(e,t){Ue(ie,function(r){e(new Uint8Array(r))},t)})}return Promise.resolve().then(function(){return wr(ie)})}function dn(){var e={a:Ts};function t(_,u){var d=_.exports;i.asm=d,A=i.asm.qa,dr(A.buffer),pr=i.asm.ua,an(i.asm.ra),cn("wasm-instantiate")}un("wasm-instantiate");function r(_){t(_.instance)}function n(_){return _n().then(function(u){return WebAssembly.instantiate(u,e)}).then(function(u){return u}).then(_,function(u){Ae("failed to asynchronously prepare wasm: "+u),Le(u)})}function l(){return!h&&typeof WebAssembly.instantiateStreaming=="function"&&!gr(ie)&&!yr(ie)&&!Je&&typeof fetch=="function"?fetch(ie,{credentials:"same-origin"}).then(function(_){var u=WebAssembly.instantiateStreaming(_,e);return u.then(r,function(d){return Ae("wasm streaming compile failed: "+d),Ae("falling back to ArrayBuffer instantiation"),n(r)})}):n(r)}if(i.instantiateWasm)try{var c=i.instantiateWasm(e,t);return c}catch(_){return Ae("Module.instantiateWasm callback failed with error: "+_),!1}return l().catch($),{}}var pn={834004:e=>{throw new Error(M(e))}};function It(e){for(;e.length>0;){var t=e.shift();if(typeof t=="function"){t(i);continue}var r=t.func;typeof r=="number"?t.arg===void 0?vt(r)():vt(r)(t.arg):r(t.arg===void 0?null:t.arg)}}var mt=[];function vt(e){var t=mt[e];return t||(e>=mt.length&&(mt.length=e+1),mt[e]=t=pr.get(e)),t}function hn(e,t,r,n){Le("Assertion failed: "+M(e)+", at: "+[t?M(t):"unknown filename",r,n?M(n):"unknown function"])}function mn(e){return ft(e+24)+24}function vn(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(t){H[this.ptr+4>>>2]=t},this.get_type=function(){return H[this.ptr+4>>>2]},this.set_destructor=function(t){H[this.ptr+8>>>2]=t},this.get_destructor=function(){return H[this.ptr+8>>>2]},this.set_refcount=function(t){O[this.ptr>>>2]=t},this.set_caught=function(t){t=t?1:0,Z[this.ptr+12>>>0]=t},this.get_caught=function(){return Z[this.ptr+12>>>0]!=0},this.set_rethrown=function(t){t=t?1:0,Z[this.ptr+13>>>0]=t},this.get_rethrown=function(){return Z[this.ptr+13>>>0]!=0},this.init=function(t,r){this.set_adjusted_ptr(0),this.set_type(t),this.set_destructor(r),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=O[this.ptr>>>2];O[this.ptr>>>2]=t+1},this.release_ref=function(){var t=O[this.ptr>>>2];return O[this.ptr>>>2]=t-1,t===1},this.set_adjusted_ptr=function(t){H[this.ptr+16>>>2]=t},this.get_adjusted_ptr=function(){return H[this.ptr+16>>>2]},this.get_exception_ptr=function(){var t=Ur(this.get_type());if(t)return H[this.excPtr>>>2];var r=this.get_adjusted_ptr();return r!==0?r:this.excPtr}}var gn=0,yn=0;function wn(e,t,r){var n=new vn(e);throw n.init(t,r),gn=e,yn++,e}var Qe={varargs:void 0,get:function(){Qe.varargs+=4;var e=O[Qe.varargs-4>>>2];return e},getStr:function(e){var t=M(e);return t}};function bn(e,t,r){return Qe.varargs=r,0}function Tn(e,t,r){}function Cn(e,t,r){}function En(e,t,r){return Qe.varargs=r,0}function An(e,t,r,n){Qe.varargs=n}function On(e,t){}function Sn(e,t,r){}var gt={};function Vt(e){for(;e.length;){var t=e.pop(),r=e.pop();r(t)}}function et(e){return this.fromWireType(H[e>>>2])}var ze={},De={},yt={},Pn=48,Rn=57;function wt(e){if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return t>=Pn&&t<=Rn?"_"+e:e}function bt(e,t){return e=wt(e),new Function("body","return function "+e+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(t)}function Mt(e,t){var r=bt(t,function(n){this.name=t,this.message=n;var l=new Error(n).stack;l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},r}var br=void 0;function Tt(e){throw new br(e)}function ke(e,t,r){e.forEach(function(u){yt[u]=t});function n(u){var d=r(u);d.length!==e.length&&Tt("Mismatched type converter count");for(var v=0;v<e.length;++v)ge(e[v],d[v])}var l=new Array(t.length),c=[],_=0;t.forEach((u,d)=>{De.hasOwnProperty(u)?l[d]=De[u]:(c.push(u),ze.hasOwnProperty(u)||(ze[u]=[]),ze[u].push(()=>{l[d]=De[u],++_,_===c.length&&n(l)}))}),c.length===0&&n(l)}function xn(e){var t=gt[e];delete gt[e];var r=t.rawConstructor,n=t.rawDestructor,l=t.fields,c=l.map(_=>_.getterReturnType).concat(l.map(_=>_.setterArgumentType));ke([e],c,_=>{var u={};return l.forEach((d,v)=>{var E=d.fieldName,C=_[v],T=d.getter,D=d.getterContext,L=_[v+l.length],Y=d.setter,Q=d.setterContext;u[E]={read:R=>C.fromWireType(T(D,R)),write:(R,p)=>{var w=[];Y(Q,R,L.toWireType(w,p)),Vt(w)}}}),[{name:t.name,fromWireType:function(d){var v={};for(var E in u)v[E]=u[E].read(d);return n(d),v},toWireType:function(d,v){for(var E in u)if(!(E in v))throw new TypeError('Missing field:  "'+E+'"');var C=r();for(E in u)u[E].write(C,v[E]);return d!==null&&d.push(n,C),C},argPackAdvance:8,readValueFromPointer:et,destructorFunction:n}]})}function kn(e,t,r,n,l){}function Ct(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function jn(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Tr=e}var Tr=void 0;function X(e){for(var t="",r=e;U[r>>>0];)t+=Tr[U[r++>>>0]];return t}var Ye=void 0;function N(e){throw new Ye(e)}function ge(e,t,r={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||N('type "'+n+'" must have a positive integer typeid pointer'),De.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;N("Cannot register type '"+n+"' twice")}if(De[e]=t,delete yt[e],ze.hasOwnProperty(e)){var l=ze[e];delete ze[e],l.forEach(c=>c())}}function Fn(e,t,r,n,l){var c=Ct(r);t=X(t),ge(e,{name:t,fromWireType:function(_){return!!_},toWireType:function(_,u){return u?n:l},argPackAdvance:8,readValueFromPointer:function(_){var u;if(r===1)u=Z;else if(r===2)u=ve;else if(r===4)u=O;else throw new TypeError("Unknown boolean type size: "+t);return this.fromWireType(u[_>>>c])},destructorFunction:null})}function $n(e){if(!(this instanceof je)||!(e instanceof je))return!1;for(var t=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=e.$$.ptrType.registeredClass,l=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)l=n.upcast(l),n=n.baseClass;return t===n&&r===l}function Nn(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function Ut(e){function t(r){return r.$$.ptrType.registeredClass.name}N(t(e)+" instance already deleted")}var Ht=!1;function Cr(e){}function Dn(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}function Er(e){e.count.value-=1;var t=e.count.value===0;t&&Dn(e)}function Ar(e,t,r){if(t===r)return e;if(r.baseClass===void 0)return null;var n=Ar(e,t,r.baseClass);return n===null?null:r.downcast(n)}var Or={};function In(){return Object.keys(nt).length}function Vn(){var e=[];for(var t in nt)nt.hasOwnProperty(t)&&e.push(nt[t]);return e}var tt=[];function Wt(){for(;tt.length;){var e=tt.pop();e.$$.deleteScheduled=!1,e.delete()}}var rt=void 0;function Mn(e){rt=e,tt.length&&rt&&rt(Wt)}function Un(){i.getInheritedInstanceCount=In,i.getLiveInheritedInstances=Vn,i.flushPendingDeletes=Wt,i.setDelayFunction=Mn}var nt={};function Hn(e,t){for(t===void 0&&N("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}function Wn(e,t){return t=Hn(e,t),nt[t]}function Et(e,t){(!t.ptrType||!t.ptr)&&Tt("makeClassHandle requires ptr and ptrType");var r=!!t.smartPtrType,n=!!t.smartPtr;return r!==n&&Tt("Both smartPtrType and smartPtr must be specified"),t.count={value:1},it(Object.create(e,{$$:{value:t}}))}function Ln(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=Wn(this.registeredClass,t);if(r!==void 0){if(r.$$.count.value===0)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function l(){return this.isSmartPointer?Et(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Et(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var c=this.registeredClass.getActualType(t),_=Or[c];if(!_)return l.call(this);var u;this.isConst?u=_.constPointerType:u=_.pointerType;var d=Ar(t,this.registeredClass,u.registeredClass);return d===null?l.call(this):this.isSmartPointer?Et(u.registeredClass.instancePrototype,{ptrType:u,ptr:d,smartPtrType:this,smartPtr:e}):Et(u.registeredClass.instancePrototype,{ptrType:u,ptr:d})}function it(e){return typeof FinalizationRegistry>"u"?(it=t=>t,e):(Ht=new FinalizationRegistry(t=>{Er(t.$$)}),it=t=>{var r=t.$$,n=!!r.smartPtr;if(n){var l={$$:r};Ht.register(t,l,t)}return t},Cr=t=>Ht.unregister(t),it(e))}function zn(){if(this.$$.ptr||Ut(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=it(Object.create(Object.getPrototypeOf(this),{$$:{value:Nn(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function Yn(){this.$$.ptr||Ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&N("Object already scheduled for deletion"),Cr(this),Er(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Gn(){return!this.$$.ptr}function Bn(){return this.$$.ptr||Ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&N("Object already scheduled for deletion"),tt.push(this),tt.length===1&&rt&&rt(Wt),this.$$.deleteScheduled=!0,this}function qn(){je.prototype.isAliasOf=$n,je.prototype.clone=zn,je.prototype.delete=Yn,je.prototype.isDeleted=Gn,je.prototype.deleteLater=Bn}function je(){}function Sr(e,t,r){if(e[t].overloadTable===void 0){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||N("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function Lt(e,t,r){i.hasOwnProperty(e)?((r===void 0||i[e].overloadTable!==void 0&&i[e].overloadTable[r]!==void 0)&&N("Cannot register public name '"+e+"' twice"),Sr(i,e,e),i.hasOwnProperty(r)&&N("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),i[e].overloadTable[r]=t):(i[e]=t,r!==void 0&&(i[e].numArguments=r))}function Jn(e,t,r,n,l,c,_,u){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=l,this.getActualType=c,this.upcast=_,this.downcast=u,this.pureVirtualFunctions=[]}function zt(e,t,r){for(;t!==r;)t.upcast||N("Expected null or instance of "+r.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Xn(e,t){if(t===null)return this.isReference&&N("null is not a valid "+this.name),0;t.$$||N('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||N("Cannot pass deleted object as a pointer of type "+this.name);var r=t.$$.ptrType.registeredClass,n=zt(t.$$.ptr,r,this.registeredClass);return n}function Zn(e,t){var r;if(t===null)return this.isReference&&N("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),e!==null&&e.push(this.rawDestructor,r),r):0;t.$$||N('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||N("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&N("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;if(r=zt(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(t.$$.smartPtr===void 0&&N("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:N("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var l=t.clone();r=this.rawShare(r,V.toHandle(function(){l.delete()})),e!==null&&e.push(this.rawDestructor,r)}break;default:N("Unsupporting sharing policy")}return r}function Kn(e,t){if(t===null)return this.isReference&&N("null is not a valid "+this.name),0;t.$$||N('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||N("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&N("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass,n=zt(t.$$.ptr,r,this.registeredClass);return n}function Qn(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function ei(e){this.rawDestructor&&this.rawDestructor(e)}function ti(e){e!==null&&e.delete()}function ri(){ye.prototype.getPointee=Qn,ye.prototype.destructor=ei,ye.prototype.argPackAdvance=8,ye.prototype.readValueFromPointer=et,ye.prototype.deleteObject=ti,ye.prototype.fromWireType=Ln}function ye(e,t,r,n,l,c,_,u,d,v,E){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=l,this.pointeeType=c,this.sharingPolicy=_,this.rawGetPointee=u,this.rawConstructor=d,this.rawShare=v,this.rawDestructor=E,!l&&t.baseClass===void 0?n?(this.toWireType=Xn,this.destructorFunction=null):(this.toWireType=Kn,this.destructorFunction=null):this.toWireType=Zn}function Pr(e,t,r){i.hasOwnProperty(e)||Tt("Replacing nonexistant public symbol"),i[e].overloadTable!==void 0&&r!==void 0?i[e].overloadTable[r]=t:(i[e]=t,i[e].argCount=r)}function ni(e,t,r){var n=i["dynCall_"+e];return r&&r.length?n.apply(null,[t].concat(r)):n.call(null,t)}function ii(e,t,r){return e.includes("j")?ni(e,t,r):vt(t).apply(null,r)}function si(e,t){var r=[];return function(){return r.length=0,Object.assign(r,arguments),ii(e,t,r)}}function re(e,t){e=X(e);function r(){return e.includes("j")?si(e,t):vt(t)}var n=r();return typeof n!="function"&&N("unknown function pointer with signature "+e+": "+t),n}var Rr=void 0;function xr(e){var t=Mr(e),r=X(t);return Oe(t),r}function At(e,t){var r=[],n={};function l(c){if(!n[c]&&!De[c]){if(yt[c]){yt[c].forEach(l);return}r.push(c),n[c]=!0}}throw t.forEach(l),new Rr(e+": "+r.map(xr).join([", "]))}function oi(e,t,r,n,l,c,_,u,d,v,E,C,T){E=X(E),c=re(l,c),u&&(u=re(_,u)),v&&(v=re(d,v)),T=re(C,T);var D=wt(E);Lt(D,function(){At("Cannot construct "+E+" due to unbound types",[n])}),ke([e,t,r],n?[n]:[],function(L){L=L[0];var Y,Q;n?(Y=L.registeredClass,Q=Y.instancePrototype):Q=je.prototype;var R=bt(D,function(){if(Object.getPrototypeOf(this)!==p)throw new Ye("Use 'new' to construct "+E);if(w.constructor_body===void 0)throw new Ye(E+" has no accessible constructor");var Ie=w.constructor_body[arguments.length];if(Ie===void 0)throw new Ye("Tried to invoke ctor of "+E+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(w.constructor_body).toString()+") parameters instead!");return Ie.apply(this,arguments)}),p=Object.create(Q,{constructor:{value:R}});R.prototype=p;var w=new Jn(E,R,p,T,Y,c,u,v),ee=new ye(E,w,!0,!1,!1),B=new ye(E+"*",w,!1,!1,!1),we=new ye(E+" const*",w,!1,!0,!1);return Or[e]={pointerType:B,constPointerType:we},Pr(D,R),[ee,B,we]})}function Yt(e,t){for(var r=[],n=0;n<e;n++)r.push(O[(t>>2)+n>>>0]);return r}function kr(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=bt(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,l=e.apply(n,t);return l instanceof Object?l:n}function Gt(e,t,r,n,l){var c=t.length;c<2&&N("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var _=t[1]!==null&&r!==null,u=!1,d=1;d<t.length;++d)if(t[d]!==null&&t[d].destructorFunction===void 0){u=!0;break}for(var v=t[0].name!=="void",E="",C="",d=0;d<c-2;++d)E+=(d!==0?", ":"")+"arg"+d,C+=(d!==0?", ":"")+"arg"+d+"Wired";var T="return function "+wt(e)+"("+E+`) {
if (arguments.length !== `+(c-2)+`) {
throwBindingError('function `+e+" called with ' + arguments.length + ' arguments, expected "+(c-2)+` args!');
}
`;u&&(T+=`var destructors = [];
`);var D=u?"destructors":"null",L=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Y=[N,n,l,Vt,t[0],t[1]];_&&(T+="var thisWired = classParam.toWireType("+D+`, this);
`);for(var d=0;d<c-2;++d)T+="var arg"+d+"Wired = argType"+d+".toWireType("+D+", arg"+d+"); // "+t[d+2].name+`
`,L.push("argType"+d),Y.push(t[d+2]);if(_&&(C="thisWired"+(C.length>0?", ":"")+C),T+=(v?"var rv = ":"")+"invoker(fn"+(C.length>0?", ":"")+C+`);
`,u)T+=`runDestructors(destructors);
`;else for(var d=_?1:2;d<t.length;++d){var Q=d===1?"thisWired":"arg"+(d-2)+"Wired";t[d].destructorFunction!==null&&(T+=Q+"_dtor("+Q+"); // "+t[d].name+`
`,L.push(Q+"_dtor"),Y.push(t[d].destructorFunction))}v&&(T+=`var ret = retType.fromWireType(rv);
return ret;
`),T+=`}
`,L.push(T);var R=kr(Function,L).apply(null,Y);return R}function ai(e,t,r,n,l,c){I(t>0);var _=Yt(t,r);l=re(n,l),ke([],[e],function(u){u=u[0];var d="constructor "+u.name;if(u.registeredClass.constructor_body===void 0&&(u.registeredClass.constructor_body=[]),u.registeredClass.constructor_body[t-1]!==void 0)throw new Ye("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+u.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return u.registeredClass.constructor_body[t-1]=()=>{At("Cannot construct "+u.name+" due to unbound types",_)},ke([],_,function(v){return v.splice(1,0,null),u.registeredClass.constructor_body[t-1]=Gt(d,v,null,l,c),[]}),[]})}function li(e,t,r,n,l,c,_,u){var d=Yt(r,n);t=X(t),c=re(l,c),ke([],[e],function(v){v=v[0];var E=v.name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),u&&v.registeredClass.pureVirtualFunctions.push(t);function C(){At("Cannot call "+E+" due to unbound types",d)}var T=v.registeredClass.instancePrototype,D=T[t];return D===void 0||D.overloadTable===void 0&&D.className!==v.name&&D.argCount===r-2?(C.argCount=r-2,C.className=v.name,T[t]=C):(Sr(T,t,E),T[t].overloadTable[r-2]=C),ke([],d,function(L){var Y=Gt(E,L,v,c,_);return T[t].overloadTable===void 0?(Y.argCount=r-2,T[t]=Y):T[t].overloadTable[r-2]=Y,[]}),[]})}var Bt=[],de=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function qt(e){e>4&&--de[e].refcount===0&&(de[e]=void 0,Bt.push(e))}function ui(){for(var e=0,t=5;t<de.length;++t)de[t]!==void 0&&++e;return e}function ci(){for(var e=5;e<de.length;++e)if(de[e]!==void 0)return de[e];return null}function fi(){i.count_emval_handles=ui,i.get_first_emval=ci}var V={toValue:e=>(e||N("Cannot use deleted val. handle = "+e),de[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var t=Bt.length?Bt.pop():de.length;return de[t]={refcount:1,value:e},t}}}};function _i(e,t){t=X(t),ge(e,{name:t,fromWireType:function(r){var n=V.toValue(r);return qt(r),n},toWireType:function(r,n){return V.toHandle(n)},argPackAdvance:8,readValueFromPointer:et,destructorFunction:null})}function di(e,t,r){switch(t){case 0:return function(n){var l=r?Z:U;return this.fromWireType(l[n>>>0])};case 1:return function(n){var l=r?ve:xe;return this.fromWireType(l[n>>>1])};case 2:return function(n){var l=r?O:H;return this.fromWireType(l[n>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function pi(e,t,r,n){var l=Ct(r);t=X(t);function c(){}c.values={},ge(e,{name:t,constructor:c,fromWireType:function(_){return this.constructor.values[_]},toWireType:function(_,u){return u.value},argPackAdvance:8,readValueFromPointer:di(t,l,n),destructorFunction:null}),Lt(t,c)}function st(e,t){var r=De[e];return r===void 0&&N(t+" has unknown type "+xr(e)),r}function hi(e,t,r){var n=st(e,"enum");t=X(t);var l=n.constructor,c=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:bt(n.name+"_"+t,function(){})}});l.values[r]=c,l[t]=c}function Jt(e){if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e}function mi(e,t){switch(t){case 2:return function(r){return this.fromWireType(_r[r>>>2])};case 3:return function(r){return this.fromWireType(Nt[r>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function vi(e,t,r){var n=Ct(r);t=X(t),ge(e,{name:t,fromWireType:function(l){return l},toWireType:function(l,c){return c},argPackAdvance:8,readValueFromPointer:mi(t,n),destructorFunction:null})}function gi(e,t,r,n,l,c){var _=Yt(t,r);e=X(e),l=re(n,l),Lt(e,function(){At("Cannot call "+e+" due to unbound types",_)},t-1),ke([],_,function(u){var d=[u[0],null].concat(u.slice(1));return Pr(e,Gt(e,d,null,l,c),t-1),[]})}function yi(e,t,r){switch(t){case 0:return r?function(l){return Z[l>>>0]}:function(l){return U[l>>>0]};case 1:return r?function(l){return ve[l>>>1]}:function(l){return xe[l>>>1]};case 2:return r?function(l){return O[l>>>2]}:function(l){return H[l>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function wi(e,t,r,n,l){t=X(t),l===-1&&(l=4294967295);var c=Ct(r),_=C=>C;if(n===0){var u=32-8*r;_=C=>C<<u>>>u}var d=t.includes("unsigned"),v=(C,T)=>{},E;d?E=function(C,T){return v(T,this.name),T>>>0}:E=function(C,T){return v(T,this.name),T},ge(e,{name:t,fromWireType:_,toWireType:E,argPackAdvance:8,readValueFromPointer:yi(t,c,n!==0),destructorFunction:null})}function bi(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],l=n[t];function c(_){_=_>>2;var u=H,d=u[_>>>0],v=u[_+1>>>0];return new l(ae,v,d)}r=X(r),ge(e,{name:r,fromWireType:c,argPackAdvance:8,readValueFromPointer:c},{ignoreDuplicateRegistrations:!0})}function Ti(e,t,r,n,l,c,_,u,d,v,E,C){r=X(r),c=re(l,c),u=re(_,u),v=re(d,v),C=re(E,C),ke([e],[t],function(T){T=T[0];var D=new ye(r,T.registeredClass,!1,!1,!0,T,n,c,u,v,C);return[D]})}function Ci(e,t){t=X(t);var r=t==="std::string";ge(e,{name:t,fromWireType:function(n){var l=H[n>>>2],c;if(r)for(var _=n+4,u=0;u<=l;++u){var d=n+4+u;if(u==l||U[d>>>0]==0){var v=d-_,E=M(_,v);c===void 0?c=E:(c+=String.fromCharCode(0),c+=E),_=d+1}}else{for(var C=new Array(l),u=0;u<l;++u)C[u]=String.fromCharCode(U[n+4+u>>>0]);c=C.join("")}return Oe(n),c},toWireType:function(n,l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));var c,_=typeof l=="string";_||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int8Array||N("Cannot pass non-string to std::string"),r&&_?c=()=>se(l):c=()=>l.length;var u=c(),d=ft(4+u+1);if(d>>>=0,H[d>>>2]=u,r&&_)fe(l,d+4,u+1);else if(_)for(var v=0;v<u;++v){var E=l.charCodeAt(v);E>255&&(Oe(d),N("String has UTF-16 code units that do not fit in 8 bits")),U[d+4+v>>>0]=E}else for(var v=0;v<u;++v)U[d+4+v>>>0]=l[v];return n!==null&&n.push(Oe,d),d},argPackAdvance:8,readValueFromPointer:et,destructorFunction:function(n){Oe(n)}})}function Ei(e,t,r){r=X(r);var n,l,c,_,u;t===2?(n=We,l=ht,_=$t,c=()=>xe,u=1):t===4&&(n=oe,l=ne,_=me,c=()=>H,u=2),ge(e,{name:r,fromWireType:function(d){for(var v=H[d>>>2],E=c(),C,T=d+4,D=0;D<=v;++D){var L=d+4+D*t;if(D==v||E[L>>>u]==0){var Y=L-T,Q=n(T,Y);C===void 0?C=Q:(C+=String.fromCharCode(0),C+=Q),T=L+t}}return Oe(d),C},toWireType:function(d,v){typeof v!="string"&&N("Cannot pass non-string to C++ string type "+r);var E=_(v),C=ft(4+E+t);return C>>>=0,H[C>>>2]=E>>u,l(v,C+4,E+t),d!==null&&d.push(Oe,C),C},argPackAdvance:8,readValueFromPointer:et,destructorFunction:function(d){Oe(d)}})}function Ai(e,t,r,n,l,c){gt[e]={name:X(t),rawConstructor:re(r,n),rawDestructor:re(l,c),fields:[]}}function Oi(e,t,r,n,l,c,_,u,d,v){gt[e].fields.push({fieldName:X(t),getterReturnType:r,getter:re(n,l),getterContext:c,setterArgumentType:_,setter:re(u,d),setterContext:v})}function Si(e,t){t=X(t),ge(e,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:function(){},toWireType:function(r,n){}})}function Pi(){return Date.now()}var Ri=!0;function xi(){return Ri}function ki(e,t,r){e=V.toValue(e),t=st(t,"emval::as");var n=[],l=V.toHandle(n);return O[r>>>2]=l,t.toWireType(n,e)}function jr(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=st(H[t+n*o>>>2],"parameter "+n);return r}function ji(e,t,r,n){e=V.toValue(e);for(var l=jr(t,r),c=new Array(t),_=0;_<t;++_){var u=l[_];c[_]=u.readValueFromPointer(n),n+=u.argPackAdvance}var d=e.apply(void 0,c);return V.toHandle(d)}function Fi(e){var t=[];return O[e>>>2]=V.toHandle(t),t}var $i={};function ot(e){var t=$i[e];return t===void 0?X(e):t}var Ot=[];function Ni(e,t,r,n,l){return e=Ot[e],t=V.toValue(t),r=ot(r),e(t,r,Fi(n),l)}function Di(e,t,r,n){e=Ot[e],t=V.toValue(t),r=ot(r),e(t,r,null,n)}function Fr(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Ii(e){return e===0?V.toHandle(Fr()):(e=ot(e),V.toHandle(Fr()[e]))}function Vi(e){var t=Ot.length;return Ot.push(e),t}var $r=[];function Mi(e,t){var r=jr(e,t),n=r[0],l=n.name+"_$"+r.slice(1).map(function(L){return L.name}).join("_")+"$",c=$r[l];if(c!==void 0)return c;for(var _=["retType"],u=[n],d="",v=0;v<e-1;++v)d+=(v!==0?", ":"")+"arg"+v,_.push("argType"+v),u.push(r[1+v]);for(var E=wt("methodCaller_"+l),C="return function "+E+`(handle, name, destructors, args) {
`,T=0,v=0;v<e-1;++v)C+="    var arg"+v+" = argType"+v+".readValueFromPointer(args"+(T?"+"+T:"")+`);
`,T+=r[v+1].argPackAdvance;C+="    var rv = handle[name]("+d+`);
`;for(var v=0;v<e-1;++v)r[v+1].deleteObject&&(C+="    argType"+v+".deleteObject(arg"+v+`);
`);n.isVoid||(C+=`    return retType.toWireType(destructors, rv);
`),C+=`};
`,_.push(C);var D=kr(Function,_).apply(null,u);return c=Vi(D),$r[l]=c,c}function Ui(e){return e=ot(e),V.toHandle(i[e])}function Hi(e,t){return e=V.toValue(e),t=V.toValue(t),V.toHandle(e[t])}function Wi(e){e>4&&(de[e].refcount+=1)}function Li(e,t){return e=V.toValue(e),t=V.toValue(t),e instanceof t}function zi(e){for(var t="",r=0;r<e;++r)t+=(r!==0?", ":"")+"arg"+r;for(var n="return function emval_allocator_"+e+`(constructor, argTypes, args) {
`,r=0;r<e;++r)n+="var argType"+r+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+r+'], "parameter '+r+`");
var arg`+r+" = argType"+r+`.readValueFromPointer(args);
args += argType`+r+`['argPackAdvance'];
`;return n+="var obj = new constructor("+t+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle",n)(st,i,V.toHandle)}var Nr={};function Yi(e,t,r,n){e=V.toValue(e);var l=Nr[t];return l||(l=zi(t),Nr[t]=l),l(e,r,n)}function Gi(){return V.toHandle([])}function Bi(e){return V.toHandle(ot(e))}function qi(){return V.toHandle({})}function Ji(e){var t=V.toValue(e);Vt(t),qt(e)}function Xi(e,t,r){e=V.toValue(e),t=V.toValue(t),r=V.toValue(r),e[t]=r}function Zi(e,t){e=st(e,"_emval_take_value");var r=e.readValueFromPointer(t);return V.toHandle(r)}function Ki(e){return e=V.toValue(e),V.toHandle(typeof e)}function Qi(e,t){var r=new Date(O[e>>>2]*1e3);O[t>>>2]=r.getSeconds(),O[t+4>>>2]=r.getMinutes(),O[t+8>>>2]=r.getHours(),O[t+12>>>2]=r.getDate(),O[t+16>>>2]=r.getMonth(),O[t+20>>>2]=r.getFullYear()-1900,O[t+24>>>2]=r.getDay();var n=new Date(r.getFullYear(),0,1),l=(r.getTime()-n.getTime())/(1e3*60*60*24)|0;O[t+28>>>2]=l,O[t+36>>>2]=-(r.getTimezoneOffset()*60);var c=new Date(r.getFullYear(),6,1).getTimezoneOffset(),_=n.getTimezoneOffset(),u=(c!=_&&r.getTimezoneOffset()==Math.min(_,c))|0;O[t+32>>>2]=u}function es(e,t,r,n,l,c){return-52}function ts(e,t,r,n,l,c){e>>>=0}function rs(e,t,r){var n=new Date().getFullYear(),l=new Date(n,0,1),c=new Date(n,6,1),_=l.getTimezoneOffset(),u=c.getTimezoneOffset(),d=Math.max(_,u);O[e>>>2]=d*60,O[t>>>2]=Number(_!=u);function v(L){var Y=L.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Y?Y[1]:"GMT"}var E=v(l),C=v(c),T=le(E),D=le(C);u<_?(H[r>>>2]=T,H[r+4>>>2]=D):(H[r>>>2]=D,H[r+4>>>2]=T)}function Xt(e,t,r){Xt.called||(Xt.called=!0,rs(e,t,r))}function ns(){Le("")}var Zt=[];function is(e,t){Zt.length=0;var r;for(t>>=2;r=U[e++>>>0];)t+=r!=105&t,Zt.push(r==105?O[t>>>0]:Nt[t++>>>1]),++t;return Zt}function ss(e,t,r){var n=is(t,r);return pn[e].apply(null,n)}function Dr(){return 4294901760}function os(){return Dr()}var Kt;Je?Kt=()=>{var e=process.hrtime();return e[0]*1e3+e[1]/1e6}:Kt=()=>performance.now();function as(e,t,r){U.copyWithin(e>>>0,t>>>0,t+r>>>0)}function ls(e){try{return A.grow(e-ae.byteLength+65535>>>16),dr(A.buffer),1}catch{}}function us(e){var t=U.length;e=e>>>0;var r=Dr();if(e>r)return!1;let n=(d,v)=>d+(v-d%v)%v;for(var l=1;l<=4;l*=2){var c=t*(1+.2/l);c=Math.min(c,e+100663296);var _=Math.min(r,n(Math.max(e,c),65536)),u=ls(_);if(u)return!0}return!1}var Qt={};function cs(){return G||"./this.program"}function at(){if(!at.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:cs()};for(var r in Qt)Qt[r]===void 0?delete t[r]:t[r]=Qt[r];var n=[];for(var r in t)n.push(r+"="+t[r]);at.strings=n}return at.strings}function fs(e,t){var r=0;return at().forEach(function(n,l){var c=t+r;H[e+l*4>>>2]=c,ue(n,c),r+=n.length+1}),0}function _s(e,t){var r=at();H[e>>>2]=r.length;var n=0;return r.forEach(function(l){n+=l.length+1}),H[t>>>2]=n,0}function ds(e){return 52}function ps(e,t,r,n){return 52}function hs(e,t,r,n,l){return 70}var ms=[null,[],[]];function vs(e,t){var r=ms[e];t===0||t===10?((e===1?Ee:Ae)(z(r,0)),r.length=0):r.push(t)}function gs(e,t,r,n){for(var l=0,c=0;c<r;c++){var _=H[t>>>2],u=H[t+4>>>2];t+=8;for(var d=0;d<u;d++)vs(e,U[_+d>>>0]);l+=u}return H[n>>>2]=l,0}function ys(e){f(e)}function Ge(e){return e%4===0&&(e%100!==0||e%400===0)}function er(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var lt=[31,29,31,30,31,30,31,31,30,31,30,31],ut=[31,28,31,30,31,30,31,31,30,31,30,31];function ct(e,t){for(var r=new Date(e.getTime());t>0;){var n=Ge(r.getFullYear()),l=r.getMonth(),c=(n?lt:ut)[l];if(t>c-r.getDate())t-=c-r.getDate()+1,r.setDate(1),l<11?r.setMonth(l+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else return r.setDate(r.getDate()+t),r}return r}function Ir(e,t,r,n){var l=O[n+40>>>2],c={tm_sec:O[n>>>2],tm_min:O[n+4>>>2],tm_hour:O[n+8>>>2],tm_mday:O[n+12>>>2],tm_mon:O[n+16>>>2],tm_year:O[n+20>>>2],tm_wday:O[n+24>>>2],tm_yday:O[n+28>>>2],tm_isdst:O[n+32>>>2],tm_gmtoff:O[n+36>>>2],tm_zone:l?M(l):""},_=M(r),u={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var d in u)_=_.replace(new RegExp(d,"g"),u[d]);var v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],E=["January","February","March","April","May","June","July","August","September","October","November","December"];function C(p,w,ee){for(var B=typeof p=="number"?p.toString():p||"";B.length<w;)B=ee[0]+B;return B}function T(p,w){return C(p,w,"0")}function D(p,w){function ee(we){return we<0?-1:we>0?1:0}var B;return(B=ee(p.getFullYear()-w.getFullYear()))===0&&(B=ee(p.getMonth()-w.getMonth()))===0&&(B=ee(p.getDate()-w.getDate())),B}function L(p){switch(p.getDay()){case 0:return new Date(p.getFullYear()-1,11,29);case 1:return p;case 2:return new Date(p.getFullYear(),0,3);case 3:return new Date(p.getFullYear(),0,2);case 4:return new Date(p.getFullYear(),0,1);case 5:return new Date(p.getFullYear()-1,11,31);case 6:return new Date(p.getFullYear()-1,11,30)}}function Y(p){var w=ct(new Date(p.tm_year+1900,0,1),p.tm_yday),ee=new Date(w.getFullYear(),0,4),B=new Date(w.getFullYear()+1,0,4),we=L(ee),Ie=L(B);return D(we,w)<=0?D(Ie,w)<=0?w.getFullYear()+1:w.getFullYear():w.getFullYear()-1}var Q={"%a":function(p){return v[p.tm_wday].substring(0,3)},"%A":function(p){return v[p.tm_wday]},"%b":function(p){return E[p.tm_mon].substring(0,3)},"%B":function(p){return E[p.tm_mon]},"%C":function(p){var w=p.tm_year+1900;return T(w/100|0,2)},"%d":function(p){return T(p.tm_mday,2)},"%e":function(p){return C(p.tm_mday,2," ")},"%g":function(p){return Y(p).toString().substring(2)},"%G":function(p){return Y(p)},"%H":function(p){return T(p.tm_hour,2)},"%I":function(p){var w=p.tm_hour;return w==0?w=12:w>12&&(w-=12),T(w,2)},"%j":function(p){return T(p.tm_mday+er(Ge(p.tm_year+1900)?lt:ut,p.tm_mon-1),3)},"%m":function(p){return T(p.tm_mon+1,2)},"%M":function(p){return T(p.tm_min,2)},"%n":function(){return`
`},"%p":function(p){return p.tm_hour>=0&&p.tm_hour<12?"AM":"PM"},"%S":function(p){return T(p.tm_sec,2)},"%t":function(){return"	"},"%u":function(p){return p.tm_wday||7},"%U":function(p){var w=p.tm_yday+7-p.tm_wday;return T(Math.floor(w/7),2)},"%V":function(p){var w=Math.floor((p.tm_yday+7-(p.tm_wday+6)%7)/7);if((p.tm_wday+371-p.tm_yday-2)%7<=2&&w++,w){if(w==53){var B=(p.tm_wday+371-p.tm_yday)%7;B!=4&&(B!=3||!Ge(p.tm_year))&&(w=1)}}else{w=52;var ee=(p.tm_wday+7-p.tm_yday-1)%7;(ee==4||ee==5&&Ge(p.tm_year%400-1))&&w++}return T(w,2)},"%w":function(p){return p.tm_wday},"%W":function(p){var w=p.tm_yday+7-(p.tm_wday+6)%7;return T(Math.floor(w/7),2)},"%y":function(p){return(p.tm_year+1900).toString().substring(2)},"%Y":function(p){return p.tm_year+1900},"%z":function(p){var w=p.tm_gmtoff,ee=w>=0;return w=Math.abs(w)/60,w=w/60*100+w%60,(ee?"+":"-")+String("0000"+w).slice(-4)},"%Z":function(p){return p.tm_zone},"%%":function(){return"%"}};_=_.replace(/%%/g,"\0\0");for(var d in Q)_.includes(d)&&(_=_.replace(new RegExp(d,"g"),Q[d](c)));_=_.replace(/\0\0/g,"%");var R=Vr(_,!1);return R.length>t?0:(te(R,e),R.length-1)}function ws(e,t,r,n){return Ir(e,t,r,n)}function ce(e){return parseInt(e)}function bs(e,t,r){for(var n=M(t),l="\\!@#$^&*()+=-[]/{}|:<>?,.",c=0,_=l.length;c<_;++c)n=n.replace(new RegExp("\\"+l[c],"g"),"\\"+l[c]);var u={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"};for(var d in u)n=n.replace(d,u[d]);var v={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"},E={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11},C={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},T={MON:0,TUE:1,WED:2,THU:3,FRI:4,SAT:5,SUN:6};for(var D in v)n=n.replace(D,"("+D+v[D]+")");for(var L=[],c=n.indexOf("%");c>=0;c=n.indexOf("%"))L.push(n[c+1]),n=n.replace(new RegExp("\\%"+n[c+1],"g"),"");var Y=new RegExp("^"+n,"i").exec(M(e));function Q(){function Fe($e,rr,zr){return typeof $e!="number"||isNaN($e)?rr:$e>=rr?$e<=zr?$e:zr:rr}return{year:Fe(O[r+20>>>2]+1900,1970,9999),month:Fe(O[r+16>>>2],0,11),day:Fe(O[r+12>>>2],1,31),hour:Fe(O[r+8>>>2],0,23),min:Fe(O[r+4>>>2],0,59),sec:Fe(O[r>>>2],0,59)}}if(Y){var R=Q(),p,w=Fe=>{var $e=L.indexOf(Fe);if($e>=0)return Y[$e+1]};if((p=w("S"))&&(R.sec=ce(p)),(p=w("M"))&&(R.min=ce(p)),p=w("H"))R.hour=ce(p);else if(p=w("I")){var ee=ce(p);(p=w("p"))&&(ee+=p.toUpperCase()[0]==="P"?12:0),R.hour=ee}if(p=w("Y"))R.year=ce(p);else if(p=w("y")){var B=ce(p);(p=w("C"))?B+=ce(p)*100:B+=B<69?2e3:1900,R.year=B}if((p=w("m"))?R.month=ce(p)-1:(p=w("b"))&&(R.month=E[p.substring(0,3).toUpperCase()]||0),p=w("d"))R.day=ce(p);else if(p=w("j"))for(var we=ce(p),Ie=Ge(R.year),Pt=0;Pt<12;++Pt){var Wr=er(Ie?lt:ut,Pt-1);we<=Wr+(Ie?lt:ut)[Pt]&&(R.day=we-Wr)}else if(p=w("a")){var Lr=p.substring(0,3).toUpperCase();if(p=w("U")){var _t=C[Lr],dt=ce(p),Se=new Date(R.year,0,1),Pe;Se.getDay()===0?Pe=ct(Se,_t+7*(dt-1)):Pe=ct(Se,7-Se.getDay()+_t+7*(dt-1)),R.day=Pe.getDate(),R.month=Pe.getMonth()}else if(p=w("W")){var _t=T[Lr],dt=ce(p),Se=new Date(R.year,0,1),Pe;Se.getDay()===1?Pe=ct(Se,_t+7*(dt-1)):Pe=ct(Se,7-Se.getDay()+1+_t+7*(dt-1)),R.day=Pe.getDate(),R.month=Pe.getMonth()}}var be=new Date(R.year,R.month,R.day,R.hour,R.min,R.sec,0);return O[r>>>2]=be.getSeconds(),O[r+4>>>2]=be.getMinutes(),O[r+8>>>2]=be.getHours(),O[r+12>>>2]=be.getDate(),O[r+16>>>2]=be.getMonth(),O[r+20>>>2]=be.getFullYear()-1900,O[r+24>>>2]=be.getDay(),O[r+28>>>2]=er(Ge(be.getFullYear())?lt:ut,be.getMonth()-1)+be.getDate()-1,O[r+32>>>2]=0,e+Vr(Y[0]).length-1}return 0}br=i.InternalError=Mt(Error,"InternalError"),jn(),Ye=i.BindingError=Mt(Error,"BindingError"),qn(),Un(),ri(),Rr=i.UnboundTypeError=Mt(Error,"UnboundTypeError"),fi();function Vr(e,t,r){var n=r>0?r:se(e)+1,l=new Array(n),c=q(e,l,0,l.length);return t&&(l.length=c),l}var Ts={a:hn,i:mn,h:wn,M:bn,T:Tn,X:Cn,da:En,N:An,aa:On,V:Sn,F:xn,U:kn,la:Fn,q:oi,v:ai,d:li,ka:_i,Q:pi,u:hi,O:vi,p:gi,B:wi,x:bi,y:Ti,P:Ci,J:Ei,G:Ai,A:Oi,ma:Si,ga:Pi,fa:xi,l:ki,pa:ji,o:Ni,r:Di,b:qt,s:Ii,k:Mi,w:Ui,m:Hi,e:Wi,R:Li,t:Yi,H:Gi,n:Bi,L:qi,g:Ji,C:Xi,j:Zi,D:Ki,ha:Qi,Y:es,Z:ts,ia:Xt,f:ns,c:ss,W:os,ea:Kt,ja:as,I:us,_:fs,$:_s,E:ds,ca:ps,S:hs,ba:gs,K:ys,oa:Ir,z:ws,na:bs},io=dn(),Cs=i.___wasm_call_ctors=function(){return(Cs=i.___wasm_call_ctors=i.asm.ra).apply(null,arguments)},ft=i._malloc=function(){return(ft=i._malloc=i.asm.sa).apply(null,arguments)},Oe=i._free=function(){return(Oe=i._free=i.asm.ta).apply(null,arguments)},Mr=i.___getTypeName=function(){return(Mr=i.___getTypeName=i.asm.va).apply(null,arguments)},Es=i.___embind_register_native_and_builtin_types=function(){return(Es=i.___embind_register_native_and_builtin_types=i.asm.wa).apply(null,arguments)},Ur=i.___cxa_is_pointer_type=function(){return(Ur=i.___cxa_is_pointer_type=i.asm.xa).apply(null,arguments)},As=i.dynCall_ji=function(){return(As=i.dynCall_ji=i.asm.ya).apply(null,arguments)},Os=i.dynCall_viij=function(){return(Os=i.dynCall_viij=i.asm.za).apply(null,arguments)},Ss=i.dynCall_viiij=function(){return(Ss=i.dynCall_viiij=i.asm.Aa).apply(null,arguments)},Ps=i.dynCall_viiijj=function(){return(Ps=i.dynCall_viiijj=i.asm.Ba).apply(null,arguments)},Rs=i.dynCall_viji=function(){return(Rs=i.dynCall_viji=i.asm.Ca).apply(null,arguments)},xs=i.dynCall_viiji=function(){return(xs=i.dynCall_viiji=i.asm.Da).apply(null,arguments)},ks=i.dynCall_viijji=function(){return(ks=i.dynCall_viijji=i.asm.Ea).apply(null,arguments)},js=i.dynCall_viijj=function(){return(js=i.dynCall_viijj=i.asm.Fa).apply(null,arguments)},Fs=i.dynCall_viijij=function(){return(Fs=i.dynCall_viijij=i.asm.Ga).apply(null,arguments)},$s=i.dynCall_viiiijii=function(){return($s=i.dynCall_viiiijii=i.asm.Ha).apply(null,arguments)},Ns=i.dynCall_vijjji=function(){return(Ns=i.dynCall_vijjji=i.asm.Ia).apply(null,arguments)},Ds=i.dynCall_jiji=function(){return(Ds=i.dynCall_jiji=i.asm.Ja).apply(null,arguments)},Is=i.dynCall_viijii=function(){return(Is=i.dynCall_viijii=i.asm.Ka).apply(null,arguments)},Vs=i.dynCall_iiiiij=function(){return(Vs=i.dynCall_iiiiij=i.asm.La).apply(null,arguments)},Ms=i.dynCall_iiiiijj=function(){return(Ms=i.dynCall_iiiiijj=i.asm.Ma).apply(null,arguments)},Us=i.dynCall_iiiiiijj=function(){return(Us=i.dynCall_iiiiiijj=i.asm.Na).apply(null,arguments)},St;function Hr(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Ke=function e(){St||tr(),St||(Ke=e)};function tr(e){if(e=e||x,Ne>0||(rn(),Ne>0))return;function t(){St||(St=!0,i.calledRun=!0,!P&&(nn(),y(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),sn()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),t()},1)):t()}if(i.run=tr,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return tr(),s.ready}})(),Br=Ls;var Rt={};Ws(Rt,{COLUMN_SEPARATOR_STRING:()=>pe,CONFIG_ALIASES:()=>Be,CONFIG_VALID_KEYS:()=>sr,DATA_TYPES:()=>zs,FILTER_OPERATORS:()=>F,SORT_ORDERS:()=>Gs,SORT_ORDER_IDS:()=>Bs,TYPE_AGGREGATES:()=>qs,TYPE_FILTERS:()=>Zs});var zs={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},Be={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},sr=["viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],qr=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","max","mean","median","min","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],ir=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],Ys=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],Gs=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],Bs=[2,0,1,0,1,3,4,3,4],qs={string:ir,float:qr,integer:qr,boolean:Ys,datetime:ir,date:ir},F={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},Js=[F.bitwiseAnd,F.bitwiseOr,F.equals,F.doesNotEqual,F.or,F.and,F.isNull,F.isNotNull],Jr=[F.lessThan,F.greaterThan,F.equals,F.lessThanOrEquals,F.greaterThanOrEquals,F.doesNotEqual,F.isNull,F.isNotNull],Xs=[F.equals,F.contains,F.doesNotEqual,F.isIn,F.isNotIn,F.beginsWith,F.endsWith,F.isNull,F.isNotNull],Xr=[F.lessThan,F.greaterThan,F.equals,F.lessThanOrEquals,F.greaterThanOrEquals,F.doesNotEqual,F.isNull,F.isNotNull],pe="|",Zs={string:Xs,float:Jr,integer:Jr,boolean:Js,datetime:Xr,date:Xr};var or={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Ve(m){let s={};if(Zr().types[m]&&Object.assign(s,Zr().types[m]),s.type){let i=Ve(s.type);return Object.assign(i,s),i}else return s}function ar(m){return m&&typeof m=="object"&&!Array.isArray(m)}function xt(m,...s){if(!s.length)return m;let i=s.shift();if(ar(m)&&ar(i))for(let y in i)ar(i[y])?(m[y]||Object.assign(m,{[y]:{}}),xt(m[y],i[y])):Object.assign(m,{[y]:i[y]});return xt(m,...s)}function Kr(m){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=xt(or,m)}function Zr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=xt(or,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function kt(m){if(m>=1&&m<=8)return"integer";if(m===19)return"string";if(m===10||m===9)return"float";if(m===11)return"boolean";if(m===12)return"datetime";if(m===13)return"date";console.warn(`Unknown type for value ${m} with JS type ${typeof m}`)}function lr(m){let s=m;do for(let i of Object.getOwnPropertyNames(s)){let y=m[i];i!=="constructor"&&typeof y=="function"&&(m[i]=y.bind(m))}while(s=s!==Object&&Object.getPrototypeOf(s))}String.prototype.includes||(String.prototype.includes=function(m,s){return typeof s!="number"&&(s=0),s+m.length>this.length?!1:this.indexOf(m,s)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(m,s){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),y=i.length>>>0;if(y===0)return!1;var $=s|0,j=Math.max($>=0?$:y-Math.abs($),0);function x(G,J){return G===J||typeof G=="number"&&typeof J=="number"&&isNaN(G)&&isNaN(J)}for(;j<y;){if(x(i[j],m))return!0;j++}return!1}});var jt=class{constructor(){this.data_formats={row:0,column:1,schema:2},this.format=void 0,this.data=void 0,this.names=void 0,this.types=void 0,this.row_count=void 0}is_format(s){if(Array.isArray(s))return this.data_formats.row;if(Array.isArray(s[Object.keys(s)[0]]))return this.data_formats.column;if(typeof s[Object.keys(s)[0]]=="string"||typeof s[Object.keys(s)[0]]=="function")return this.data_formats.schema;throw`Could not determine data format for ${JSON.stringify(s)}, with JS typeof ${typeof s}`}count_rows(s){return this.format===this.data_formats.row?s.length:this.format===this.data_formats.column?s[Object.keys(s)[0]].length:0}get_format(){return this.format}get(s,i){let y;if(this.format===this.data_formats.row){let $=this.data[i];$.hasOwnProperty(s)&&(y=$[s])}else if(this.format===this.data_formats.column)this.data.hasOwnProperty(s)&&(y=this.data[s][i]);else if(this.format===this.data_formats.schema)y=void 0;else throw`Could not get() from dataset - ${this.data} is poorly formatted.`;return y}marshal(s,i,y){let $=this.names[s],j=Ks(this.get($,i));if(j===null)return null;if(!(typeof j>"u")){switch(kt(y.value)){case"float":case"integer":{j=Number(j);break}case"boolean":{typeof j=="string"?j.toLowerCase()==="true"?j=!0:j=!1:j=!!j;break}case"datetime":case"date":break;default:j+=""}return j}}clean(){this.names=void 0,this.types=void 0}init(s){this.data=s,this.format=this.is_format(this.data),this.row_count=this.count_rows(this.data);let i={};if(this.format===this.data_formats.row)s.length>0?this.names=Object.keys(s[0]):this.clean.names=[];else if(this.format===this.data_formats.column)this.names=Object.keys(s);else if(this.format===this.data_formats.schema){this.names=Object.keys(s);for(let y of this.names){let $=Ve(s[y]);$.type&&(console.debug(`Converting "${s[y]}" to "${$.type}"`),i[y]=s[y],s[y]=$.type)}}else throw`Could not initialize - failed to determine format for ${s}`;return i}};function Ks(m){return m===null||m==="null"?null:m===void 0||m==="undefined"?void 0:m}var ur=function(m){let s=[];for(let i=0;i<m.size();i++){let y=m.get(i);s.push(y)}return m.delete(),s},cr=function(m){let s={},i=m.keys();for(let y=0;y<i.size();y++){let $=i.get(y);s[$]=m.get($)}return m.delete(),i.delete(),s},qe=function(m,s){for(let i of s)m.push_back(i);return m};function Qs(m){let s={};return typeof m!="string"?Object.getOwnPropertyNames(m).forEach(i=>{s[i]=m[i]},m):s.message=m,s}var pt=class{constructor(s){this.perspective=s,this._tables={},this._views={},this._callback_cache=new Map}init(s){s.config&&Kr(s.config),s.data=["wait_for_response"],this.post(s)}post(s){throw new Error(`Posting ${s} failed - post() not implemented!`)}process(s,i){switch(s.cmd){case"init_profile_thread":this.perspective.initialize_profile_thread();break;case"memory_usage":this.post({id:s.id,data:this.perspective.memory_usage()});break;case"init":this.init(s);break;case"table":if(typeof s.args[0]>"u")this._tables[s.name]=[];else try{let x=this._tables[s.name],G=this.perspective.table(s.args[0],s.options);if(G&&G.then)G.then(J=>{if(this._tables[s.name]=J,x)for(let he of x)this.process(he);this.post({id:s.id,data:s.name})}).catch(J=>this.process_error(s,J));else{if(this._tables[s.name]=G,x)for(let J of x)this.process(J);this.post({id:s.id,data:s.name})}}catch(x){this.process_error(s,x);return}break;case"table_generate":(0,eval)(s.args)(function(x){this._tables[s.name]=x,this.post({id:s.id,data:"created!"})});break;case"table_execute":(0,eval)(s.f)(this._tables[s.name]);break;case"table_method":case"view_method":this.process_method_call(s);break;case"view":let j=this._tables[s.table_name];if(j&&Array.isArray(j))j.push(s),this._views[s.view_name]=[];else try{let x=this._views[s.view_name],G=this._tables[s.table_name].view(s.config);if(G&&G.then)G.then(J=>{if(this._views[s.view_name]=J,this._views[s.view_name].client_id=i,x)for(let he of x)this.process(he);this.post({id:s.id,data:s.view_name})}).catch(J=>this.process_error(s,J));else{if(this._views[s.view_name]=G,this._views[s.view_name].client_id=i,x)for(let J of x)this.process(J);this.post({id:s.id,data:s.view_name})}}catch(x){this.process_error(s,x);return}break}}process_subscribe(s,i){try{let y;s.method.slice(0,2)==="on"?(y=$=>{let j={id:s.id,data:$};try{if(s.args&&s.args[0]&&s.method==="on_update"&&s.args[0].mode==="row"){this.post(j,[$.delta]);return}this.post(j)}catch{console.error(`Removing failed callback to \`${s.method}()\` (presumably due to failed connection)`);let G=s.method.substring(3);i[`remove_${G}`](y)}},s.callback_id&&this._callback_cache.set(s.callback_id,y)):s.callback_id&&(y=this._callback_cache.get(s.callback_id),this._callback_cache.delete(s.callback_id)),y?i[s.method](y,...s.args):console.error(`Callback not found for remote call "${JSON.stringify(s)}"`)}catch(y){this.process_error(s,y);return}}process_method_call(s){let i,y,$=s.view_name||s.name;if(s.cmd==="table_method"?i=this._tables[$]:i=this._views[$],!i&&s.cmd==="view_method"){this.process_error(s,{message:"View method cancelled"});return}if(i&&i.push){i.push(s);return}try{if(s.subscribe){this.process_subscribe(s,i);return}else y=i[s.method].apply(i,s.args),y instanceof Promise?y.then(j=>this.process_method_call_response(s,j)).catch(j=>this.process_error(s,j)):this.process_method_call_response(s,y)}catch(j){this.process_error(s,j);return}}process_method_call_response(s,i){s.method==="delete"&&delete this._views[s.name],s.method==="to_arrow"?this.post({id:s.id,data:i},[i]):this.post({id:s.id,data:i})}process_error(s,i){this.post({id:s.id,error:Qs(i)})}clear_views(s){for(let i of Object.keys(this._views))if(this._views[i].client_id===s){try{this._views[i].delete()}catch(y){console.error(y)}delete this._views[i]}console.debug(`GC ${Object.keys(this._views).length} views in memory`)}};var eo={initDataValue:()=>[],initRowValue:()=>({}),initColumnValue:(m,s)=>{},initColumnRowPath:(m,s,i)=>s[i]=[],setColumnValue:(m,s,i,y)=>s[i]=y,addColumnValue:(m,s,i,y)=>s[i].unshift(y),addRow:(m,s)=>m.push(s),formatData:m=>m,slice:(m,s)=>m.slice(s)},to={initDataValue:()=>new Object,initRowValue:()=>{},initColumnValue:(m,s)=>{m[s]=[]},setColumnValue:(m,s,i,y)=>{m[i].push(y)},addColumnValue:(m,s,i,y)=>{m[i][m[i].length-1].unshift(y)},initColumnRowPath:(m,s,i)=>{m[i]=m[i]||[],m[i].push([])},addRow:()=>{},formatData:m=>m,slice:(m,s)=>{let i={};for(let y in m)i[y]=m[y].slice(s);return i}},fr={jsonFormatter:eo,jsonTableFormatter:to};typeof self<"u"&&self.performance===void 0&&(self.performance={now:Date.now});var Ft=new Set;function Qr(m){let s=m,i=new jt,y=["zero","one","two"],$={};function j(o,a){$[a]?o.delete():($[a]=o,setTimeout(()=>x(a)))}function x(o){let a=$[o];a&&(a._process(),G(o))}function G(o){$[o]?.delete(),delete $[o]}function J(){let o=performance.memory?JSON.parse(JSON.stringify(performance.memory,["totalJSHeapSize","usedJSHeapSize","jsHeapSizeLimit"])):process.memoryUsage();return o.wasmHeap=s.HEAP8.length,o}function he(o,a,f,h,g,A,P,b,I){f||(f=""),h||(h=4294967295),a=s.make_table(a,o,h,f,g,A,P,b,I);let S=a.get_pool(),z=a.get_id();return A||g==s.t_op.OP_DELETE?j(S,z):(S._process(),S.delete()),a}function k(o,a,f,h,g){this.name=g,this._View=void 0,this.table=o,this.config=f||{},this.view_config=h||new h,this.is_unit_context=this.table.index===""&&a===0&&this.view_config.group_by.length===0&&this.view_config.split_by.length===0&&this.view_config.filter.length===0&&this.view_config.sort.length===0&&this.view_config.expressions.length===0,this.is_unit_context?this._View=s.make_view_unit(o._Table,g,pe,this.view_config,null):a===0?this._View=s.make_view_zero(o._Table,g,pe,this.view_config,null):a===1?this._View=s.make_view_one(o._Table,g,pe,this.view_config,null):a===2&&(this._View=s.make_view_two(o._Table,g,pe,this.view_config,null)),this.ctx=this._View.get_context(),this.column_only=this._View.is_column_only(),this.update_callbacks=this.table.update_callbacks,this.overridden_types=this.table.overridden_types,this._delete_callbacks=[],lr(this)}k.prototype.get_config=function(){return JSON.parse(JSON.stringify(this.config))},k.prototype.delete=function(){G(this.table.get_id()),this._View.delete(),this.ctx.delete(),this.table.views.splice(this.table.views.indexOf(this),1),this.table=void 0;let o=0,a=0;for(;o<this.update_callbacks.length;){let f=this.update_callbacks[o];f.view!==this&&(this.update_callbacks[a++]=f),o++}this.update_callbacks.length=a,this._delete_callbacks.forEach(f=>f())},k.prototype.sides=function(){return this._View.sides()},k.prototype._num_hidden=function(){let o=0;for(let a of this.config.sort)this.config.columns.indexOf(a[0])===-1&&o++;return o};function Je(o){let a=[];for(let f=0;f<o.size();f++){let h=o.get(f);a.push(s.scalar_to_val(h,!1,!0)),h.delete()}return o.delete(),a}let K=function(o){let a=[];for(let f=0;f<o.size();f++){let h=o.get(f);a.push(Je(h))}return o.delete(),a};k.prototype.schema=function(o=!0){let a=cr(this._View.schema());if(o)for(let f of Object.keys(a)){let h=f.split(pe);h=h[h.length-1],this.overridden_types[h]&&Ve(this.overridden_types[h]).type===a[f]&&(a[f]=this.overridden_types[h])}return a},k.prototype.expression_schema=function(o=!0){let a=cr(this._View.expression_schema());if(o)for(let f of Object.keys(a)){let h=f.split(pe);h=h[h.length-1],this.overridden_types[h]&&Ve(this.overridden_types[h]).type===a[f]&&(a[f]=this.overridden_types[h])}return a},k.prototype._column_names=function(o=!1,a=0){return K(this._View.column_names(o,a)).map(f=>f.join(pe))},k.prototype.column_paths=function(){return K(this._View.column_paths()).map(o=>o.join(pe))},k.prototype.get_data_slice=function(o,a,f,h){if(this.is_unit_context)return s.get_data_slice_unit(this._View,o,a,f,h);{let g=this.sides(),A=y[g];return s[`get_data_slice_${A}`](this._View,o,a,f,h)}};let Xe=function(o){o=o||{};let a=this._View.num_columns()+(this.sides()===0?0:1),f=this._View.num_rows(),h=this._num_hidden(),g=this.sides()>0||this.column_only?1:0,A=this.config.viewport?this.config.viewport:{},P=o.start_row||(A.top?A.top:0),b=Math.min(f,o.end_row!==void 0?o.end_row:A.height?P+A.height:f),I=o.start_col||(A.left?A.left:0),S=Math.min(a,(o.end_col!==void 0?o.end_col+g:A.width?I+A.width:a)*(h+1));return o.start_row=Math.floor(P),o.end_row=Math.ceil(b),o.start_col=Math.floor(I),o.end_col=Math.ceil(S),o};k.prototype.get_min_max=function(o){if(this.is_unit_context)return s.get_min_max_unit(this._View,o);{let a=this.sides(),f=y[a];return s[`get_min_max_${f}`](this._View,o)}};let Me=function(o,a){x(this.table.get_id()),o=Xe.bind(this)(o);let f=o.start_row,h=o.end_row,g=o.start_col,A=o.end_col,P=this._num_hidden(),b=o.formatted,I=!!o.index,S=!!o.id,z=!!o.leaves_only,M=this.sides(),q=M!==0&&!this.column_only,fe=y[M],se;this.is_unit_context?se=s.get_from_data_slice_unit:se=s[`get_from_data_slice_${fe}`];let _e=this.get_data_slice(f,h,g,A),We=_e.get_column_names(),ht=K(We).map(ne=>ne.join(pe)),$t=this.schema(),oe=a.initDataValue();for(let ne=g;ne<A;ne++){let me=ht[ne];a.initColumnValue(oe,me)}for(let ne=f;ne<h;ne++){let me=q?_e.get_row_path(ne):void 0;if(q&&z&&me.size()<this.config.group_by.length){me.delete();continue}let le=a.initRowValue();S&&a.initColumnRowPath(oe,le,"__ID__");for(let te=g;te<A;te++){let ue=ht[te],ae=$t[ue],Z=Ve(ae);if(te===g&&M!==0){if(!this.column_only){a.initColumnRowPath(oe,le,"__ROW_PATH__");for(let U=0;U<me.size();U++){let ve=me.get(U),xe=s.scalar_to_val(ve,!1,!1);ve.delete(),a.addColumnValue(oe,le,"__ROW_PATH__",xe),S&&a.addColumnValue(oe,le,"__ID__",xe)}}}else{if((te-(M>0?1:0))%(this.config.columns.length+P)>=this.config.columns.length)continue;{let U=se(_e,ne,te);b&&U!==null&&U!==void 0&&(ae==="datetime"||ae==="date")&&(U=new Date(U),U=U.toLocaleString([],Z.format)),a.setColumnValue(oe,le,ue,U)}}}if(I){let te=_e.get_pkeys(ne,0);a.initColumnRowPath(oe,le,"__INDEX__");for(let ue=0;ue<te.size();ue++){let ae=te.get(ue),Z=s.scalar_to_val(ae,!1,!1);ae.delete(),a.addColumnValue(oe,le,"__INDEX__",Z)}te.delete()}if(S&&M===0){let te=_e.get_pkeys(ne,0);for(let ue=0;ue<te.size();ue++){let ae=te.get(ue),Z=s.scalar_to_val(ae,!1,!1);ae.delete(),a.addColumnValue(oe,le,"__ID__",Z)}te.delete()}me&&me.delete(),a.addRow(oe,le)}return _e.delete(),a.formatData(oe,o.config)},Ue=function(o,a,f){let h=this.num_rows(),g=a.start_row||0,A=a.end_row||h,b=this._column_names().indexOf(o);if(b===-1)return;this.sides()>0&&b++;let S,z;a.data_slice?S=a.data_slice.get_column_slice(b):(z=this.get_data_slice(g,A,b,b+1),S=z.get_slice());let M=this._View.get_column_dtype(b),q=f(S,M,b);return S.delete(),z&&z.delete(),q};k.prototype.to_columns=function(o){return Me.call(this,o,fr.jsonTableFormatter)},k.prototype.to_json=function(o){return Me.call(this,o,fr.jsonFormatter)},k.prototype.to_csv=function(o){x(this.table.get_id()),o=Xe.bind(this)(o);let a=o.start_row,f=o.end_row,h=o.start_col,g=o.end_col,A=this.sides();if(this.is_unit_context)return s.to_csv_unit(this._View,a,f,h,g);if(A===0)return s.to_csv_zero(this._View,a,f,h,g);if(A===1)return s.to_csv_one(this._View,a,f,h,g);if(A===2)return s.to_csv_two(this._View,a,f,h,g)},k.prototype.col_to_js_typed_array=function(o,a={}){x(this.table.get_id());let f=s.col_to_js_typed_array;return Ue.call(this,o,a,f)},k.prototype.to_arrow=function(o={}){x(this.table.get_id()),o=Xe.bind(this)(o);let a=o.start_row,f=o.end_row,h=o.start_col,g=o.end_col,A=this.sides();if(this.is_unit_context)return s.to_arrow_unit(this._View,a,f,h,g);if(A===0)return s.to_arrow_zero(this._View,a,f,h,g);if(A===1)return s.to_arrow_one(this._View,a,f,h,g);if(A===2)return s.to_arrow_two(this._View,a,f,h,g)},k.prototype.num_rows=function(){return x(this.table.get_id()),this._View.num_rows()},k.prototype.num_columns=function(){let o=this._View.num_columns(),a=this._num_hidden();return o-o/(this.config.columns.length+a)*a},k.prototype.dimensions=function(){return{num_table_rows:this.table.num_rows(),num_table_columns:this.table.num_columns(),num_view_rows:this._View.num_rows(),num_view_columns:this.num_columns()}},k.prototype.get_row_expanded=function(o){return this._View.get_row_expanded(o)},k.prototype.expand=function(o){return this._View.expand(o,this.config.group_by.length)},k.prototype.collapse=function(o){return this._View.collapse(o)},k.prototype.set_depth=function(o){return this._View.set_depth(o,this.config.group_by.length)},k.prototype._get_step_delta=async function(){let o=this._View.get_step_delta(0,2147483647),a;if(o.cells.size()===0)a=this.to_json();else{let f={};for(let g=0;g<o.cells.size();g++)f[o.cells.get(g).row]=!0;f=Object.keys(f);let h=f.map(g=>this.to_json({start_row:Number.parseInt(g),end_row:Number.parseInt(g)+1}));a=[].concat.apply([],h)}return o.cells.delete(),a},k.prototype._get_row_delta=async function(){if(this.is_unit_context)return s.get_row_delta_unit(this._View);{let o=this.sides(),a=y[o];return s[`get_row_delta_${a}`](this._View)}},k.prototype.on_update=function(o,{mode:a="none"}={}){if(x(this.table.get_id()),["none","row"].indexOf(a)===-1)throw new Error(`Invalid update mode "${a}" - valid modes are "none" and "row".`);a==="row"&&(this._View._get_deltas_enabled()||this._View._set_deltas_enabled(!0)),this.update_callbacks.push({view:this,orig_callback:o,callback:async(f,h)=>{h[f]===void 0&&(h[f]={});let g={port_id:f};a==="row"&&(h[f].row_delta===void 0&&(h[f].row_delta=await this._get_row_delta()),g.delta=h[f].row_delta),o(g)}})};function Re(o,a){let f=0,h=0;for(;f<o.length;){let g=o[f];a(g,f,o)&&(o[h++]=g),f++}return o.length=h,o}k.prototype.remove_update=function(o){x(this.table.get_id());let a=this.update_callbacks.length;Re(this.update_callbacks,f=>f.orig_callback!==o),console.assert(a>this.update_callbacks.length,'"callback" does not match a registered updater')},k.prototype.on_delete=function(o){this._delete_callbacks.push(o)},k.prototype.remove_delete=function(o){let a=this._delete_callbacks.length;Re(this._delete_callbacks,f=>f!==o),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')};function Te(o){this.group_by=o.group_by||[],this.split_by=o.split_by||[],this.aggregates=o.aggregates||{},this.columns=o.columns,this.filter=o.filter||[],this.sort=o.sort||[],this.expressions=o.expressions||[],this.filter_op=o.filter_op||"and",this.group_by_depth=o.group_by_depth,this.split_by_depth=o.split_by_depth}Te.prototype.get_group_by=function(){let o=s.make_string_vector();return qe(o,this.group_by)},Te.prototype.get_split_by=function(){let o=s.make_string_vector();return qe(o,this.split_by)},Te.prototype.get_columns=function(){let o=s.make_string_vector();return qe(o,this.columns)},Te.prototype.get_filter=function(){let o=s.make_2d_val_vector();for(let a of this.filter){let f=s.make_val_vector(),h=qe(f,a);o.push_back(h)}return o},Te.prototype.get_sort=function(){let o=s.make_2d_string_vector();for(let a of this.sort){let f=s.make_string_vector(),h=qe(f,a);o.push_back(h)}return o},Te.prototype.get_expressions=function(){let o=s.make_2d_val_vector();for(let a of this.expressions){let f=s.make_val_vector();for(let h of a)f.push_back(h);o.push_back(f)}return o};function W(o,a,f,h){this._Table=o;let g=this._Table.get_gnode();this.gnode_id=g.get_id(),g.delete();let A=this._Table.get_pool();A.set_update_delegate(this),A.delete(),this.name=Math.random()+"",this.initialized=!1,this.index=a,this.limit=f,this.update_callbacks=[],this._delete_callbacks=[],this.views=[],this.overridden_types=h,lr(this)}W.prototype.get_id=function(){return this._Table.get_id()},W.prototype.get_pool=function(){return this._Table.get_pool()},W.prototype.make_port=function(){return this._Table.make_port()},W.prototype.remove_port=function(){this._Table.remove_port()},W.prototype._update_callback=function(o){let a={};for(let f in this.update_callbacks)this.update_callbacks[f].callback(o,a)},W.prototype.get_index=function(){return this.index},W.prototype.get_limit=function(){return this.limit},W.prototype.clear=function(){x(this.get_id()),this._Table.reset_gnode(this.gnode_id)},W.prototype.replace=function(o){G(this.get_id()),this._Table.reset_gnode(this.gnode_id),this.update(o),x(this.get_id())},W.prototype.delete=function(){if(this.views.length>0)throw`Cannot delete Table as it still has ${this.views.length} registered View(s).`;G(this.get_id()),this._Table.unregister_gnode(this.gnode_id),this._Table.delete();for(let o of this._delete_callbacks)o()},W.prototype.on_delete=function(o){this._delete_callbacks.push(o)},W.prototype.remove_delete=function(o){let a=this._delete_callbacks.length;Re(this._delete_callbacks,f=>f!==o),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')},W.prototype.size=function(){return x(this._Table.get_id()),this._Table.size()},W.prototype.num_rows=function(){return this.size()},W.prototype.num_columns=function(){let o=this._Table.get_schema(),a=o.columns(),f=a.size();return a.delete(),o.delete(),f-1},W.prototype.schema=function(o=!0){let a=this._Table.get_schema(),f=a.columns(),h=a.types(),g={};for(let A=0;A<f.size();A++){let P=f.get(A);P!=="psp_okey"&&(o&&this.overridden_types[P]?g[P]=this.overridden_types[P]:g[P]=kt(h.get(A).value))}return a.delete(),f.delete(),h.delete(),g};function He(o){let a=[],f={};for(let h of o){if(h.includes('""')){console.error(`Skipping expression '${h}', as it cannot reference an empty column!`);continue}let g={},A={},P=0,b,I=h.match(/^\/\/(?<alias>.+?)\n/);I?.groups?.alias&&(b=I.groups.alias.trim()),(!b||b.length==0)&&(b=h);let S=h.replace(/([a-zA-Z_]+[a-zA-Z0-9_]*)/g,q=>q=="true"?"True":q=="false"?"False":q);S=S.replace(/\"(.*?[^\\])\"/g,(q,fe)=>{if(fe=fe.replace(/\\"/g,'"'),g[fe]===void 0){let se=`COLUMN${P}`;g[fe]=se,A[se]=fe}return P++,g[fe]}),S=S.replace(/'(.*?[^\\])'/g,q=>`intern(${q})`);let z=(q,fe,se,_e)=>{let We=q.indexOf(se);return`${q.substring(0,We)}'${_e}'${q.substring(We+se.length)}`};S=S.replace(/(bucket|match|match_all|search|indexof)\(.*?,\s*(intern\(\'(.+)\'\)).*\)/g,z),S=S.replace(/(replace_all|replace)\(.*?,\s*(intern\(\'(.*)\'\)),.*\)/g,z);let M=[b,h,S,A];if(f[b]!==void 0){let q=f[b];a[q]=M}else a.push(M),f[b]=a.length-1}return a}W.prototype.validate_expressions=function(o,a=!0){let f={expression_schema:{},expression_alias:{},errors:{}};if(!o||o.length===0)return f;o=He(o);let h=s.make_2d_val_vector();for(let S of o){let z=s.make_val_vector();for(let M of S)z.push_back(M);h.push_back(z),f.expression_alias[S[0]]=S[1]}let g=s.validate_expressions(this._Table,h),A=g.get_expression_schema(),P=g.get_expression_errors(),b=A.keys();for(let S=0;S<b.size();S++){let z=b.get(S),M=A.get(z);a&&this.overridden_types[z]&&(M=this.overridden_types[z]),f.expression_schema[z]=M}let I=P.keys();for(let S=0;S<I.size();S++){let z=I.get(S),M=P.get(z);f.errors[z]=M}return I.delete(),b.delete(),P.delete(),A.delete(),g.delete(),f},W.prototype.is_valid_filter=function(o){if(o[1]===Ee.FILTER_OPERATORS.isNull||o[1]===Ee.FILTER_OPERATORS.isNotNull)return!0;let a=o[2];if(a===null)return!1;let f=this.schema();return f[o[0]]&&(f[o[0]]==="date"||f[o[0]]==="datetime")?s.is_valid_datetime(o[2]):typeof a<"u"&&a!==null},W.prototype.view=function(o={}){x(this._Table.get_id());let a={};for(let b of Object.keys(o))if(Be[b])if(!a[Be[b]])Ft.has(b)||(console.warn(`Deprecated: "${b}" config parameter, please use "${Be[b]}" instead`),Ft.add(b)),a[Be[b]]=o[b];else throw new Error(`Duplicate configuration parameter "${b}"`);else if(b==="aggregate"){Ft.has("aggregate")||(console.warn('Deprecated: "aggregate" config parameter has been replaced by "aggregates" and "columns"'),Ft.add("aggregate")),a.aggregates={},a.columns=[];for(let I of o.aggregate)a.aggregates[I.column]=I.op,a.columns.push(I.column)}else if(sr.indexOf(b)>-1)a[b]=o[b];else throw new Error(`Unrecognized config parameter "${b}"`);a.group_by=a.group_by||[],a.split_by=a.split_by||[],a.aggregates=a.aggregates||{},a.filter=a.filter||[],a.sort=a.sort||[],a.expressions=a.expressions||[];let f=this.schema();if(a.expressions.length>0&&(a.expressions=He(a.expressions)),a.columns===void 0&&(a.columns=this.columns(),a.expressions.length>0))for(let b of a.expressions)a.columns.push(b[0]);if(a.filter.length>0)for(let b of a.filter){let I=f[b[0]];b[1]!==Ee.FILTER_OPERATORS.isNull&&b[1]!==Ee.FILTER_OPERATORS.isNotNull&&(I==="date"||I==="datetime")&&(b[2]=new Date(b[2]))}let h=Math.random()+"",g;a.group_by.length>0||a.split_by.length>0?a.split_by&&a.split_by.length>0?g=2:g=1:g=0;let A=new Te(a),P=new k(this,g,a,A,h);return this.views.push(P),P};let Ce;function Ze(){if(Ce===void 0){let o=0,a=performance.now();setTimeout(function f(){let h=performance.now();console.log(`${(1e3*o/(h-a)).toFixed(2)} msgs/sec`),o=0,a=h,setTimeout(f,5e3)},5e3),Ce=function(h){o+=h},console.log("Profiling initialized")}}W.prototype.query_columns=function(o,a){let f=this.view(o),h=f.to_columns(a);return f.delete(),h},W.prototype.update=function(o,a){a=a||{},a.port_id=a.port_id||0;let f,h=this.columns(),g=this._Table.get_schema(),A=g.types(),P=!1,b=!1;if(f=i,o instanceof ArrayBuffer?(f=new Uint8Array(o),P=!0):typeof o=="string"?(o[0]===","&&(o="_"+o),b=!0,P=!0,f=o):(i.init(o),i.names=h.concat(i.names.filter(I=>I==="__INDEX__")),i.types=ur(A).slice(0,h.length),Ce&&Ce(i.row_count)),!P){if(f.row_count===0){console.warn("table.update called with no data - ignoring");return}i.names.indexOf("__INDEX__")!=-1&&(!!this.index?i.types.push(i.types[i.names.indexOf(this.index)]):i.types.push(s.t_dtype.DTYPE_INT32))}try{let I=s.t_op.OP_INSERT;he(f,this._Table,this.index,this.limit,I,!0,P,b,a.port_id).delete(),this.initialized=!0}catch(I){console.error(`Update failed: ${I}`)}finally{g.delete()}},W.prototype.remove=function(o,a){if(!this.index){console.error("Cannot call `remove()` on a Table without a user-specified index.");return}a=a||{},a.port_id=a.port_id||0;let f,h=this.columns(),g=this._Table.get_schema(),A=g.types(),P=!1;o=o.map(b=>({[this.index]:b})),o instanceof ArrayBuffer?(f=new Uint8Array(o),P=!0):(i.init(o),i.names=[this.index],i.types=[ur(A)[h.indexOf(this.index)]],f=i);try{let b=s.t_op.OP_DELETE;he(f,this._Table,this.index,this.limit,b,!1,P,!1,a.port_id).delete(),this.initialized=!0}catch(b){console.error("Remove failed",b)}finally{g.delete()}},W.prototype.columns=function(){let o=this._Table.get_schema(),a=o.columns(),f=[];for(let h=0;h<a.size();h++){let g=a.get(h);g!=="psp_okey"&&f.push(g)}return o.delete(),a.delete(),f},W.prototype.execute=function(o){o(this)};let Ee={__module__:s,Server:pt,worker:function(){return this},initialize_profile_thread:Ze,memory_usage:J,table:function(o,a){a=a||{},a.index=a.index||null,a.limit=a.limit||null;let f,h=!1,g={},A=!1;if(o instanceof ArrayBuffer||typeof Buffer<"u"&&o instanceof Buffer?(f=new Uint8Array(o),h=!0):typeof o=="string"?(o[0]===","&&(o="_"+o),A=!0,h=!0,f=o):(i.clean(),g=i.init(o),f=i),a.index&&a.limit)throw`Cannot specify both index '${a.index}' and limit '${a.limit}'.`;let P;try{let b=s.t_op.OP_INSERT;return P=he(f,void 0,a.index,a.limit,b,!1,h,A,0),new W(P,a.index,a.limit,g)}catch(b){throw P&&P.delete(),console.error(`Table initialization failed: ${b}`),b}}};for(let o of Object.keys(Rt))Ee[o]=Rt[o];class Ae extends pt{constructor(a){super(a),self.addEventListener("message",f=>this.process(f.data),!1)}post(a,f){self.postMessage(a,f)}init(a){if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported");s({wasmBinary:a.buffer,wasmJSMethod:"native-wasm"}).then(f=>{s=f,s.init(),ro(),super.init(a)})}}return typeof self<"u"&&self.addEventListener&&new Ae(Ee),Ee}function ro(){if(typeof self<"u")try{if(self.dispatchEvent&&!self._perspective_initialized&&self.document!==null){self._perspective_initialized=!0;let m=self.document.createEvent("Event");m.initEvent("perspective-ready",!1,!0),self.dispatchEvent(m)}else!self.document&&self.postMessage&&self.postMessage({})}catch{}}var jo=globalThis.perspective=Qr(Br);})();
